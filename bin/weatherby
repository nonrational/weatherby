#!/usr/bin/env node

'use strict'

process.title = 'weatherby'

const weather = require('weather-js'),
      toTitleCase = require('titlecase'),
      degreeUnits = 'F'

const processArgs = process.argv.slice(2).join(" ")

if (!processArgs) {
  console.error("May I inquire as to your location? Sincerely, Weatherby")
  process.exit(1)
}

const searchTerms = [...new Set(processArgs.split(",").map(item => item.trim().toLowerCase()))]

function printFormattedWeather(query, err, result) {
  const locationName = result[0]['location']['name']
  const currentTemp = result[0]['current']['temperature']
  const currentSky = result[0]['current']['skytext']

  console.log(`[${query}] It is ${currentTemp}Â°${degreeUnits} and ${currentSky} in ${locationName}.`)
}

searchTerms.forEach(ele => {
  if (ele){
    const normalizedQueryStr = toTitleCase(ele)

    weather.find({search: normalizedQueryStr, degreeType: degreeUnits}, function(err, result){
      if (err || !result.length) {
        console.error(`[${normalizedQueryStr}] Unable to find weather information. Got error "${err || 'Not Found'}"`)
      } else {
        printFormattedWeather(normalizedQueryStr, err, result)
      }
    })
  }
})

